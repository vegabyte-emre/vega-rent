<analysis>**original_problem_statement:**
The user's primary goal is to build a SuperAdmin Panel to function as a multi-tenant corporate car rental platform. This central panel must be capable of provisioning, deploying, and managing complete, isolated Rent A Car application stacks for different tenants on a user-provided KVM server managed by Portainer.

Subsequently, the user requested a significant expansion of the SuperAdmin panel into a full-fledged SaaS platform, including:
**PRODUCT REQUIREMENTS:**
-   **SuperAdmin SaaS Landing Page:** A modern, multi-lingual public-facing website to market the platform and its subscription plans.
-   **Subscription System:** Allow new customers to sign up for different packages (e.g., Starter, Professional). New sign-ups should appear in the SuperAdmin panel with a Pending Approval status.
-   **Payment Integration:** Integrate a payment gateway (user selected Iyzico as an option) to automate subscriptions. Initially, a manual bank transfer option is acceptable.
-   **Franchise Management:** A system for managing franchise/dealership applications.
-   **Support/Ticket System:** An integrated helpdesk for tenants to create support requests and for SuperAdmins to manage them.
-   **3rd Party Integration Management:** A centralized place to manage integrations for tenants (SMS, E-Fatura, GPS, HGS, etc.).

**User's preferred language**: The user communicates in **Turkish**. The next agent MUST respond in Turkish only.

**what currently exists?**
The initial goal of automated, KVM-native tenant provisioning via the Portainer API is complete and stable. The system uses a template-based approach to deploy new tenants.

The agent has since built several major features for the SuperAdmin SaaS platform:
1.  **SaaS Landing Page:** A complete, multi-lingual (TR, EN, DE, FR, RU) landing page has been developed and is ready for deployment.
2.  **Subscription Management:** A full-featured backend and frontend module for creating, viewing, and managing company subscriptions and payments within the SuperAdmin panel.
3.  **Support/Ticket System:** A two-way communication system is in place, allowing tenants to create support tickets and SuperAdmins to manage and respond to them.
4.  **Tenant Code Updates:** A critical feature was added that allows the SuperAdmin to update the code of existing tenants from the master template without wiping their data.
5.  **Image Persistence Fix:** The initial blocker where uploaded images were not persistent has been resolved by storing image data directly in MongoDB.

**Last working item**:
-   **Last item agent was working:** The agent was in the middle of implementing the **Franchise (Bayilik) Management** system. The backend models and API endpoints have been created in , and the main UI component () has been generated. The work stopped before this new page was integrated into the application's routing and menu, and before the franchise application form was added to the public landing page.
-   **Status**: IN PROGRESS
-   **Agent Testing Done**: N
-   **Which testing method agent to use?**: manual testing by curl, screenshot tool
-   **User Testing Done**: N

**All Pending/In progress Issue list**:
-   **Issue 1**: Frontend Test Suite Failures (Priority: P2)
-   **Issue 2**: Monolithic Backend Codebase (Priority: P2)

**Issues Detail**:
-   **Issue 1**:
    -   **Description**: The frontend test suite has a long-standing low success rate (~90%) that has not been addressed. While not a blocker, it indicates potential underlying fragility.
    -   **Attempted fixes**: None.
    -   **Next debug checklist**: Run the test suite, identify the consistently failing tests, and investigate the related components.
    -   **Why fix this issue and what will be achieved with the fix?**: Improves code quality and reduces the risk of future regressions.
    -   **Status**: NOT STARTED
    -   **Is recurring issue?**: Y
    -   **Should Test frontend/backend/both after fix?**: Frontend

-   **Issue 2**:
    -   **Description**: The main backend file, , has become a large monolith containing all API logic for tenants, superadmin, public pages, subscriptions, tickets, and franchises. This makes maintenance difficult and increases the risk of conflicts.
    -   **Next debug checklist**: Propose a refactoring plan to the user to split  into multiple  instances, organized by feature (e.g., , ).
    -   **Why fix this issue and what will be achieved with the fix?**: Significantly improves maintainability, scalability, and code organization of the backend.
    -   **Status**: NOT STARTED
    -   **Is recurring issue?**: N
    -   **Should Test frontend/backend/both after fix?**: Backend

**In progress Task List**:
-   **Task 1**: Complete Franchise (Bayilik) Management System (Priority: P0)
    -   **Where to resume**:
        1.  Integrate the new  page:
            -   Import it in .
            -   Add a new route for .
            -   Add a link to the Franchises page in the  navigation menu.
        2.  Create a Franchise Application section/form on the public  that submits to the  endpoint.
        3.  Thoroughly test the end-to-end flow: submitting an application from the landing page and managing it (approve/reject) in the SuperAdmin panel.
    -   **What will be achieved with this?**: A complete module for managing franchise applications, fulfilling a key user requirement.
    -   **Status**: IN PROGRESS
    -   **Should Test frontend/backend/both after fix?**: Both
    -   **Blocked on something**: None.

**Upcoming and Future Tasks**
**Upcoming Tasks:**
-   **P0: Implement Payment Gateway (iyzico):** Integrate iyzico to automate the subscription payment process. This is the next logical step after the subscription system.
-   **P1: Integrate 3rd Party Services:**
    -   **SMS Integration** (Provider: Netgsm).
    -   **E-Invoice Integration** (Provider: EDM Bilişim).
-   **P2: Implement Pending Approval Flow:** Ensure that new companies created via subscription purchases on the landing page appear in the SuperAdmin panel with a  status.

**Future Tasks:**
-   Advanced Integrations (GPS, HGS, WhatsApp, KABİS).
-   Customer Mobile App.
-   NFC integration (user requested to defer).

**Completed work in this session**
-   **Implemented Tenant Code Update Feature:** Added functionality to update existing tenant applications from the master template without data loss, including UI buttons for single and bulk updates.
-   **Built SaaS Landing Page:** Developed a complete, multi-lingual, and modern landing page to market the platform, including pricing, features, and a demo request form.
-   **Implemented Subscription System:** Created a full module in the SuperAdmin panel to manage company subscriptions, plans, and manual payment records.
-   **Implemented Support/Ticket System:** Built a two-way helpdesk for tenants to submit tickets and SuperAdmins to manage them.
-   **Resolved KVM Deployment/Connection Issues:**
    -   Established a manual deployment workflow by creating downloadable  update packages for the user to apply on their KVM server.
    -   Fixed the Portainer Disconnected bug by correcting the Portainer URL in the backend configuration.
-   **Fixed Image Persistence:** Re-architected image uploads to use MongoDB for persistent storage, solving a critical blocker for the theme management feature.
-   **Refined SuperAdmin UI:** Removed redundant deployment buttons from the companies page, simplifying the user interface.

**Earlier issues found/mentioned but not fixed**
-   **Issue 1: Frontend Test Suite Failures:** An 85-90% success rate was reported in test runs and has not been addressed.

**Known issue recurrence from previous fork**
-   **Issue recurrence in previous fork**: Frontend test suite failures.
-   **Recurrence count**: 5+
-   **Status**: NOT STARTED

**Code Architecture**


**Key Technical Concepts**
-   **KVM-Native Orchestration:** Using the backend to call the Portainer API for all container management on the user's server.
-   **Manual KVM Update Packages:** The established deployment method involves creating a  archive with updated code and a shell script () for the user to run on their server.
-   **MongoDB for File Storage:** Storing user-uploaded images (logos, sliders) as data within MongoDB collections to ensure persistence across container restarts.
-   **Multi-lingual Frontend:** A React Context-based solution for managing translations stored in a central JS object.

**key DB schema**
-   : Holds tenant information, including status and subscription details.
-   : Stores uploaded image data.
-   : Manages subscription plans, start/end dates, and status for each company.
-   : Logs manual payment records.
-    & : Manages the helpdesk system.
-   : New collection to store applications from the landing page.
-   : Stores leads from the landing page contact form.

**All files of reference**
-   : Critical file, contains all new API logic for subscriptions, tickets, and franchises.
-   : Contains KVM orchestration logic, including the tenant update function.
-   : Contains routing for all new pages.
-   : The new, partially integrated franchise management page.
-   : The entry point for the new public-facing website.
-   : The layout for the superadmin panel, needs a link to the new franchises page.

**Areas that need refactoring**:
-   ** is a monolith.** It should be broken down into separate FastAPI routers for maintainability. This is becoming critical as more features are added.

**key api endpoints**
-   : (New) Public endpoint for submitting a franchise application.
-   : (New) Endpoints for managing franchise applications.
-   : Endpoints for the support ticket system.
-   : Endpoints for the subscription management system.
-   : Endpoint to trigger a code update for an existing tenant.

**Critical Info for New Agent**
-   **Language is Turkish:** All user-facing communication must be in Turkish.
-   **KVM Deployment is Manual:** You cannot deploy directly to the user's server. The required workflow is: build the frontend, package the changed files (frontend build + backend code) into a , create an  script, and provide the user with a download link and / instructions to execute on their KVM server.
-   **Resume the Franchise Task:** Your immediate priority is to complete the partially implemented Franchise Management system. This involves integrating the new frontend page into the router/menu and adding an application form to the public landing page.
-   **Propose Refactoring:** After completing the franchise task, strongly consider proposing a refactor of  to the user. Explain that breaking it into smaller, feature-specific router files will make future development much faster and safer.

**documents and test_reports created in this job**
-   : Contains the design system for the new landing page.

**Last 10 User Messages and any pending HUMAN messages**
-    (User confirming to proceed with the next task after the support system was completed)
-    (User confirming to proceed with the next task from the list)
-   (The rest are agent messages detailing the start of the Franchise Management feature)

**Project Health Check:**
-   **Broken**: The Franchise Management feature is incomplete. The UI is not yet connected.
-   **Mocked**: Payment processing (iyzico), SMS (Netgsm), E-Invoice (EDM), and other 3rd party integrations are planned but not implemented.

**3rd Party Integrations**
-   **Portainer**: Used for infrastructure orchestration via its REST API.
-   **Traefik**: Used for reverse proxy and SSL (configured on the user's KVM, not by the agent).
-   **iyzipay**: Planned for payment integration (library installed).
-   **Netgsm**: Planned for SMS integration.
-   **EDM Bilişim**: Planned for E-Invoice integration.

**Testing status**
-   **Testing agent used after significant changes**: YES, for the image upload fix.
-   **Troubleshoot agent used after agent stuck in loop**: NO
-   **Test files created**: None.
-   **Known regressions**: None.

**What agent forgot to execute**
-   The agent has not yet addressed the long-standing issue of failing frontend tests.
-   The agent has continued to add features to the monolithic  file without proposing a necessary refactor.</analysis>
